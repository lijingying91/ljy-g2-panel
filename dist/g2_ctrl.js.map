{"version":3,"sources":["../src/g2_ctrl.js"],"names":["MetricsPanelCtrl","appEvents","_","G2","G2Ctrl","$scope","$injector","panelDefaults","G2DataHandler","defaults","panel","events","on","onDataReceived","bind","onDataError","onInitEditMode","render","dataList","data","addEditorTab","scope","elem","attrs","ctrl","chart","height","destroy","Chart","container","id","forceFit","handler","Function","e","emit","message","renderingCompleted","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAESA,sB,kBAAAA,gB;;AACAC,e,gBAAAA,S;;AACFC,O;;AACAC,Q;;;;;;;;;;;;;;;;;;;;;wBAEMC,M;;;AAAkC;;AAE7C,wBAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,sHACvBD,MADuB,EACfC,SADe;;AAG7B,cAAMC,gBAAgB;AACpBC;AADoB,WAAtB;;AAgBAN,YAAEO,QAAF,CAAW,MAAKC,KAAhB,EAAuBH,aAAvB;;AAEA,gBAAKI,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKC,cAAL,CAAoBC,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKG,WAAL,CAAiBD,IAAjB,OAA7B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKC,cAAL,CAAoBC,IAApB,OAArC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKI,cAAL,CAAoBF,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKK,MAAL,CAAYH,IAAZ,OAApC;AAzB6B;AA0B9B;;;;yCAEcI,Q,EAAU;AACvB,iBAAKC,IAAL,GAAYD,YAAY,KAAKC,IAA7B;AACA,iBAAKF,MAAL;AACD;;;wCAEa;AACZ,iBAAKE,IAAL,GAAY,EAAZ;AACA,iBAAKF,MAAL;AACD;;;2CAEgB;AACf;AACA,iBAAKG,YAAL,CAAkB,QAAlB,EAA4B,qDAA5B,EAAmF,CAAnF;AACD;;;yCAEc;AACb,iBAAKH,MAAL;AACD;;;+BAEII,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC7B,gBAAIC,QAAQ,IAAZ;AACA,qBAASR,MAAT,GAAkB;AAChB,kBAAIS,SAASF,KAAKE,MAAL,IAAe,GAA5B;AACA,kBAAID,KAAJ,EAAW;AACTA,sBAAME,OAAN;AACD;AACDF,sBAAQ,IAAItB,GAAGyB,KAAP,CAAa;AACnBC,mCAAiBL,KAAKd,KAAL,CAAWoB,EADT;AAEnBC,0BAAU,IAFS;AAGnBL;AAHmB,eAAb,CAAR;AAKA,kBAAI;AACF;AACA,oBAAIM,UAAU,IAAIC,QAAJ,CAAa,UAAb,EAAyB,OAAzB,EAAkCT,KAAKd,KAAL,CAAWF,aAA7C,CAAd;AACAwB,wBAAQR,KAAKL,IAAb,EAAmBM,KAAnB;AACD,eAJD,CAIE,OAAOS,CAAP,EAAU;AACVjC,0BAAUkC,IAAV,CAAe,eAAf,EAAgC,CAAC,mBAAD,EAAsBD,EAAEE,OAAF,IAAaF,CAAnC,CAAhC;AACA,sBAAMA,CAAN;AACD;AACF;;AAEDV,iBAAKb,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAM;AAC7BK;AACAO,mBAAKa,kBAAL;AACD,aAHD;AAID;;;;QA3EyBrC,gB;;;;AA8E5BI,aAAOkC,WAAP,GAAqB,aAArB","file":"g2_ctrl.js","sourcesContent":["/* eslint-disable class-methods-use-this */\n/* eslint-disable prefer-const */\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'; // eslint-disable-line\nimport { appEvents } from 'app/core/core'; // eslint-disable-line\nimport _ from 'lodash';\nimport G2 from './libs/g2.min'; // eslint-disable-line\n\nexport class G2Ctrl extends MetricsPanelCtrl { // eslint-disable-line\n\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    const panelDefaults = {\n      G2DataHandler: `\nconsole.log(dataList);\nconst data = [\n  { genre: 'Sports', sold: 275 },\n  { genre: 'Strategy', sold: 115 },\n  { genre: 'Action', sold: 120 },\n  { genre: 'Shooter', sold: 350 },\n  { genre: 'Other', sold: 150 }\n];\nchart.source(data);\nchart.interval().position('genre*sold').color('genre');\nchart.render();\n`,\n    };\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n  }\n\n  onDataReceived(dataList) {\n    this.data = dataList || this.data;\n    this.render();\n  }\n\n  onDataError() {\n    this.data = [];\n    this.render();\n  }\n\n  onInitEditMode() {\n    // this.addEditorTab('数据', 'public/plugins/ljy-g2-panel/partials/editer-metric.html', 2);\n    this.addEditorTab('G2图表配置', 'public/plugins/ljy-g2-panel/partials/editor-g2.html', 3);\n  }\n\n  editorG2Data() {\n    this.render();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    let chart = null;\n    function render() {\n      let height = ctrl.height || 200;\n      if (chart) {\n        chart.destroy();\n      }\n      chart = new G2.Chart({\n        container: `g2_${ctrl.panel.id}`,\n        forceFit: true,\n        height,\n      });\n      try {\n        // eslint-disable-next-line no-new-func\n        let handler = new Function('dataList', 'chart', ctrl.panel.G2DataHandler);\n        handler(ctrl.data, chart);\n      } catch (e) {\n        appEvents.emit('alert-warning', ['DataHandler代码运行错误', e.message || e]);\n        throw e;\n      }\n    }\n\n    ctrl.events.on('render', () => {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n}\n\nG2Ctrl.templateUrl = 'module.html';\n"]}